<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      #board  {
        width: 300px;
        height: 300px;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        grid-template-rows: 1fr 1fr 1fr;
      }
      #board>.tile {
        width: 100px;
        height: 100px;
        border: solid 2px black;
      }
      .checked-green {
        background-color: chartreuse;
      }
      .checked-red {
        background-color: rgb(255, 0, 0);
      }
      .win1 {
        background-color: rgb(188, 247, 24);
      }
      .win2 {
        background-color: rgb(255, 141, 48);
      }
    </style>
  </head>
  <body>
    <div id="board">
      <div class="tile" id="1" x="1" y="3"></div>
      <div class="tile" id="2" x="2" y="3"></div>
      <div class="tile" id="3" x="3" y="3"></div>
      <div class="tile" id="4" x="1" y="2"></div>
      <div class="tile" id="5" x="2" y="2"></div>
      <div class="tile" id="6" x="3" y="2"></div>
      <div class="tile" id="7" x="1" y="1"></div>
      <div class="tile" id="8" x="2" y="1"></div>
      <div class="tile" id="9" x="3" y="1"></div>
    </div>
    <script>
      const tiles = document.querySelectorAll(".tile");
      const gameBoard = document.getElementById("board");


      function creatUser (name) {
        let allCoordinates = [];
        let winCoordinates = [];
        let currentCoordinate = {};
        
        function writeCo (num1, num2){
          currentCoordinate = {x:num1,y:num2};
          allCoordinates.push(currentCoordinate);
        };
        
        function checkWin (){
          let xC = currentCoordinate.x;
          let yC = currentCoordinate.y;

          let arrRow = allCoordinates.filter((object)=>object.y === yC);
          let arrCol = allCoordinates.filter((object)=>object.x === xC);
          let arrK1 = allCoordinates.filter((object)=>object.x-xC === object.y-yC);
          let arrKM1 = allCoordinates.filter((object)=>object.y-yC === xC-object.x);

          const arrAll = [arrRow, arrCol, arrK1, arrKM1];
          const arrWin = arrAll.filter((array)=>array.length>2);
          console.log(arrWin);

          if(arrWin.length>0){
            
            this.winCoordinates= arrWin[0];

            return true;
          }else{
            return false;
          }
        };

        return {name, winCoordinates, writeCo, checkWin,}
      }

      const player = function(){
        let name1 = prompt("your name1");
        let name2 = prompt("your name2");
        const player1 = creatUser(name1);
        const player2 = creatUser(name2);
        return {player1,player2};
      }();

      const board = function (){
        let currentPlayer = player.player1;
        let winClass = "win1";
        function setCurrentPlayer(){
          if (currentPlayer===player.player1){
            currentPlayer = player.player2;
            winClass = "win2";
          }else{
            currentPlayer = player.player1;
            winClass = "win1";
          };
        } 

        function play(event){
          let a = event.target.getAttribute("x")
          let b = event.target.getAttribute("y")

          if(currentPlayer===player.player1){
            event.target.setAttribute("class","tile checked-green");
          } else{
            event.target.setAttribute("class","tile checked-red");
          }

          currentPlayer.writeCo(a,b);
          
          if(currentPlayer.checkWin()){
            for(let i=0;i<3;i++){
              let xWin = currentPlayer.winCoordinates[i].x;
              let yWin = currentPlayer.winCoordinates[i].y;
              document.querySelector(`[x= "${xWin}"][y= "${yWin}"]`).setAttribute("class",`tile ${winClass}`);
            }
            console.log(`Yay Player ${currentPlayer.name} won!`);
          };
          setCurrentPlayer();
        }

        return{play,}
      }();

      for(let i=0; i<9; i++){
        tiles[i].addEventListener("click",board.play,{ once: true })
      };
    </script>
  </body>