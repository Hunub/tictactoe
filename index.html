<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      #board  {
        width: 300px;
        height: 300px;
        display: grid;
        grid-template-columns: auto auto auto;
        grid-template-rows: auto auto auto;
      }
      .tile {
        width: 100px;
        height: 100px;
        border: solid 2px black;
      }
      .checked-green {
        background-color: chartreuse;
      }
      .checked-red {
        background-color: rgb(255, 0, 0);
      }

    </style>
  </head>
  <body>
    <div id="board">
      <div class="tile" id="1" x="1" y="3"></div>
      <div class="tile" id="2" x="2" y="3"></div>
      <div class="tile" id="3" x="3" y="3"></div>
      <div class="tile" id="4" x="1" y="2"></div>
      <div class="tile" id="5" x="2" y="2"></div>
      <div class="tile" id="6" x="3" y="2"></div>
      <div class="tile" id="7" x="1" y="1"></div>
      <div class="tile" id="8" x="2" y="1"></div>
      <div class="tile" id="9" x="3" y="1"></div>
    </div>
    <script>
      const tiles = document.querySelectorAll(".tile");
      console.log(tiles);
      for(let i=0; i<9; i++){
        tiles[i].addEventListener("click",(e)=>{
            // let a = e.target.getAttribute("x")
            // let b = e.target.getAttribute("y")
            // e.target.setAttribute("class","tile checked");
            board.play(e);
            // player.player1.writeCo(a,b);
            console.log(player);
            // console.log(player["player1"].checkWin())
          }
        )
      };

      function creatUser (name) {
        let allCoordinates = [];
        let currentCoordinate = {};
        
        function writeCo (num1, num2){
          this.currentCoordinate = {x:num1,y:num2};
          this.allCoordinates.push(this.currentCoordinate);
        };
        
        function checkWin (){
          let xC = this.currentCoordinate.x;
          let yC = this.currentCoordinate.y;

          function convertToOrigin (object){
            let xO = object.x - xC;
            let yO = object.y - yC;
            return {x:xO, y:yO};
          }

          let convertedCoordinates = this.allCoordinates.map(convertToOrigin);

          // to be deleted later
          // function checkRow(object){
          //   return object.y === 0;
          // };
          // function checkCol(object){
          //   return object.x === 0;
          // };
          // function checkK1(object){
          //   return object.x === object.y;
          // };
          // function checkKM1(object){
          //   return object.y === -object.x
          // };

          // console.log(convertedCoordinates.filter(checkRow));
          // console.log(convertedCoordinates.filter(checkCol));
          // console.log(convertedCoordinates.filter(checkK1));
          // console.log(convertedCoordinates.filter(checkKM1));
          //


          let lRow = convertedCoordinates.filter((object)=>object.y === 0).length;
          let lCol = convertedCoordinates.filter((object)=>object.x === 0).length;
          let lK1 = convertedCoordinates.filter((object)=>object.x === object.y).length;
          let lKM1 = convertedCoordinates.filter((object)=>object.y === -object.x).length;

          if(lRow >2 || lCol >2 || lK1 >2 || lKM1 >2){
            return true;
          }else{
            return false;
          }
        };

        return {name, currentCoordinate, allCoordinates, writeCo, checkWin,}
      }

      const player = function(){
        let name1 = prompt("your name1");
        let name2 = prompt("your name2");
        const player1 = creatUser(name1);
        const player2 = creatUser(name2);
        return {player1,player2};
      }();

      const board = function (){
        let currentPlayer = "player1"
        function setCurrentPlayer(){
          if (this.currentPlayer==="player1"){
            this.currentPlayer = "player2";
          }else{
            this.currentPlayer = "player1";
          };
        } 

        function play(e){
          let a = e.target.getAttribute("x")
          let b = e.target.getAttribute("y")
          if(this.currentPlayer==="player1"){
            e.target.setAttribute("class","tile checked-green");
          } else{
            e.target.setAttribute("class","tile checked-red");
          }
          player[`${this.currentPlayer}`].writeCo(a,b);
          if(player[`${this.currentPlayer}`].checkWin()){
            console.log(`Yay ${this.currentPlayer} won!`);
          };
          this.setCurrentPlayer();
        }

        return{currentPlayer, setCurrentPlayer, play,}
      }();

    </script>
  </body>